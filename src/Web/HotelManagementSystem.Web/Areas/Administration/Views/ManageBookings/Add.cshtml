@using System.Globalization
@model BookingInputModel
@{
    this.ViewData["Title"] = "Make a book";
}

<section id="general">

    <div class="content-header">
        <h1>Manual booking</h1>
    </div>
    <div class="welcome col-md-6">
        <form method="post" enctype="multipart/form-data">
            <div>
                <p><strong>@Model.CheckIn.ToString("d", DateTimeFormatInfo.InvariantInfo)</strong> - <strong>@Model.CheckOut.ToString("d", DateTimeFormatInfo.InvariantInfo)</strong></p>
                <p><strong>Guests:</strong> @Model.GuestsCount</p>
                <p><strong>Price:</strong> $<span id="price-id">@Model.Price</span></p>
                <p><strong>Beds:</strong> @string.Join(", ", Model.BedTypes.Select(x => x.Name).ToList())</p>
            </div>

            <hr />

            <input type="hidden" asp-for="AccommodationId" />
            <input type="hidden" asp-for="Price" />
            <input type="hidden" asp-for="CheckIn" />
            <input type="hidden" asp-for="CheckOut" />
            <div class="form-group row">
                <label asp-for="FirstName"></label>
                <input asp-for="FirstName" class="form-control" />
                <span asp-validation-for="FirstName" class="text-danger"></span>
            </div>

            <div class="form-group row">
                <label asp-for="LastName"></label>
                <input asp-for="LastName" class="form-control" />
                <span asp-validation-for="LastName" class="text-danger"></span>
            </div>

            <div class="form-group row">
                <label asp-for="PhoneNumber"></label>
                <input asp-for="PhoneNumber" class="form-control" />
                <span asp-validation-for="PhoneNumber" class="text-danger"></span>
            </div>

            <div class="form-group row">
                @foreach (var facility in Model.Facilities)
                {
                    <div class="col-md-6" id="facilities-ids">
                        @if (facility.PricePerDay == 0)
                        {
                            <input id="facility_@facility.Id"
                               type="checkbox"
                               name="FacilitiesIds"
                               checked
                               disabled
                               price="@(facility.PricePerDay * Model.Days)"
                               value="@facility.Id" />
                        }
                        else if (Model.FacilitiesIds != null && Model.FacilitiesIds.Contains(facility.Id))
                        {
                            <input id="facility_@facility.Id"
                               type="checkbox"
                               name="FacilitiesIds"
                               checked
                               price="@(facility.PricePerDay * Model.Days)"
                               value="@facility.Id" />
                        }
                        else
                        {
                            <input id="facility_@facility.Id"
                               type="checkbox"
                               name="FacilitiesIds"
                               price="@(facility.PricePerDay * Model.Days)"
                               value="@facility.Id" />
                        }

                        <label for="facility_@facility.Id">@facility.Name</label>
                    </div>
                }
            </div>

            <div class="justify-content-center">
                <button class="genric-btn primary mx-auto d-block">Book!</button>
            </div>
        </form>
    </div>
</section>
<br />

@section Scripts {
    <script>
        let facilities = Array.from(document.querySelectorAll("#facilities-ids input"));
        let price = document.getElementById("price-id");

        for (let i = 0; i < facilities.length; i++) {
            let currentFacility = facilities[i];
            currentFacility.addEventListener("input", (e) => {
                let currentPrice = parseInt(e.target.getAttribute("price"));
                if (e.target.checked) {
                    let newPrice = parseInt(price.innerText) + currentPrice;
                    price.innerText = newPrice;
                } else {
                    let newPrice = parseInt(price.innerText) - currentPrice;
                    price.innerText = newPrice;
                }

            })
        }
    </script>
}
